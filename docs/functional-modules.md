# 功能模块分析

## 1. WebServer 核心模块

### 1.1 模块概述
WebServer 是整个系统的主控模块，负责协调各个子模块的工作，处理服务器的启动、停止等核心功能。

### 1.2 主要职责
- 初始化服务器配置
- 启动和停止服务器
- 管理路由映射
- 协调连接管理器和线程池工作

### 1.3 接口设计
- `WebServer(const Config& config)` - 构造函数，接受配置参数
- `bool start()` - 启动服务器
- `void stop()` - 停止服务器
- `void addRoute(const std::string& path, Router::RequestHandler handler)` - 添加路由处理函数

## 2. 连接管理模块 (ConnectionManager)

### 2.1 模块概述
ConnectionManager 负责管理所有客户端连接，包括连接的创建、维护和清理。

### 2.2 主要职责
- 管理客户端连接信息
- 限制连接数防止资源耗尽
- 监控连接活跃状态
- 自动清理过期连接
- 统计连接和请求数据

### 2.3 核心功能
- 连接数限制（每个IP和每个客户端）
- Keep-alive 连接支持
- 连接超时管理
- 连接统计信息收集

## 3. 线程池模块 (ThreadPool)

### 3.1 模块概述
ThreadPool 实现了一个高效的线程池，用于并发处理客户端请求，避免为每个连接创建新线程的开销。

### 3.2 主要职责
- 管理固定数量的工作线程
- 分发任务给空闲线程
- 提供线程安全的任务队列

### 3.3 核心功能
- 异步任务提交和执行
- 线程生命周期管理
- 任务队列管理
- 线程同步机制

## 4. 路由管理模块 (Router)

### 4.1 模块概述
Router 负责将 HTTP 请求的 URL 路径映射到相应的处理函数。

### 4.2 主要职责
- 维护 URL 路径与处理函数的映射关系
- 根据请求路径查找对应的处理函数
- 执行请求处理函数并返回响应

### 4.3 核心功能
- 动态路由注册
- 路径匹配和处理函数调用
- 请求参数传递

## 5. HTTP 解析模块 (HttpParser)

### 5.1 模块概述
HttpParser 负责解析 HTTP 请求和构建 HTTP 响应，是网络通信协议的核心实现。

### 5.2 主要职责
- 解析 HTTP 请求报文
- 构建 HTTP 响应报文
- 支持分块传输编码

### 5.3 核心功能
- HTTP 请求解析（路径、头部、正文）
- HTTP 响应构建（状态码、头部、正文）
- 分块传输编码支持
- HTTP 对象封装和解析

## 6. 日志系统模块 (Logger)

### 6.1 模块概述
Logger 提供线程安全的日志记录功能，支持多种日志级别和输出方式。

### 6.2 主要职责
- 记录系统运行日志
- 支持多级别日志输出
- 提供彩色终端输出增强可读性

### 6.3 核心功能
- 多级别日志记录（TRACE, DEBUG, INFO, WARNING, ERROR, FATAL）
- 文件和控制台双重输出
- 线程安全的日志写入
- 时间戳记录

## 7. 配置管理模块 (Config)

### 7.1 模块概述
Config 负责加载和管理服务器配置，支持 JSON 格式的配置文件。

### 7.2 主要职责
- 解析和加载 JSON 配置文件
- 提供配置项的读取和设置接口
- 支持嵌套配置项访问

### 7.3 核心功能
- JSON 配置文件解析
- 配置项获取和设置
- 嵌套配置项支持
- 默认值处理

## 8. 内存池模块 (MemoryPool & MultiLevelMemoryPool)

### 8.1 模块概述
内存池模块提供高效的内存分配机制，减少动态内存分配的开销，提升系统性能。

### 8.2 主要职责
- 预分配内存块以提高分配效率
- 减少内存碎片
- 提供线程安全的内存分配接口

### 8.3 核心功能
- 固定大小内存块分配（MemoryPool）
- 多级内存池支持不同大小的内存分配（MultiLevelMemoryPool）
- 内存分配和回收
- 线程安全机制

## 9. 限流模块 (TokenBucket)

### 9.1 模块概述
TokenBucket 实现了令牌桶算法，用于请求限流，防止服务器过载。

### 9.2 主要职责
- 控制请求处理速率
- 防止突发流量冲击

### 9.3 核心功能
- 令牌桶算法实现
- 令牌生成和消费
- 限流控制

## 10. HTTP 扩展模块

### 10.1 模块概述
HTTP 扩展模块提供了 HTTP 协议的高级功能支持。

### 10.2 包含组件
- **HttpRequest/HttpResponse**: HTTP 请求和响应对象封装
- **HttpProcessor**: HTTP 请求处理流程管理
- **HttpCompressionMiddleware**: HTTP 压缩中间件
- **ContentNegotiator**: 内容协商处理器
- **CompressionPolicy**: 压缩策略管理
- **PipelinedConnectionHandler**: 管道连接处理器

### 10.3 核心功能
- HTTP 对象模型
- 请求处理流程
- 数据压缩和解压缩
- 内容协商机制
- HTTP 管道支持